{% extends "tcms_master.html" %}

{% block subtitle %} {{ target.name }}{{ target.summary }}{% endblock %}

{% block custom_javascript %}
<script type="text/javascript" src="{{ STATIC_URL }}js/testplan_actions.js"></script>
<script type="text/javascript" src='{{ STATIC_URL }}js/testcase_actions.js'></script>
<script type="text/javascript" src='{{ STATIC_URL }}js/deleconfirm.js'></script>
<script type="text/javascript">
Nitrate.Utils.after_page_load(Nitrate.TestPlans.Attachment.on_load);
</script>
{% endblock %}

{% block page_content %}
{# breadcrumb for target which holds attachments. #}
{% block breadcrumb %}{% endblock %}

{% if request.user.is_authenticated %}
<div class="row toolbar-pf">
	<div class="col-sm-12">
		<form class="toolbar-pf-actions" action="{% url "upload-file" %}" method="POST" enctype="multipart/form-data">
			<input type="hidden" name="target" value="{{ target_name }}" />
			<input type="hidden" name="target_pk" value="{{ target.pk }}" />
			<div class="form-group">
				<input type="file" class="btn btn-default" name="upload_file" id="upload_file" limit="{{ limit }}" />
			</div>
			<div class="form-group">
				<button type="submit" class="btn btn-primary"><i class="fas fa-cloud-upload-alt"></i> Upload</button>
				<button type="button" class="btn btn-default js-back-button">Back</button>
			</div>
			<div class="form-group">
				Note: Each attachment size is limited to <strong>{{ limit_readable }}</strong>.
			</div>
		</form>
	</div>
</div>
{% endif %}

<table class="table table-striped table-bordered" style="margin-top: 20px">
	<thead>
		<tr>
			<th>File name</th>
			<th style="width: 10%">Submitter</th>
			<th style="width: 20%">Create date</th>
			<th style="width: 20%">Mimetype</th>
			<th style="width: 10%">Action</th>
		</tr>
	</thead>
	<tbody>
		{% for attachment in target.attachment.all %}
		<tr id="{{ attachment.attachment_id }}">
			<td><a href="{% url "check-file" attachment.attachment_id %}">{{ attachment.file_name }}</a></td>
			<td>{{ attachment.submitter }}</td>
			<td>{{ attachment.create_date }}</td>
			<td>{{ attachment.mime_type }}</td>
			<td>
				<a href="{% url "check-file" attachment.attachment_id %}">View</a>
				|
				<a href="#" data-toggle="modal" data-target="#delete-confirm-dialog"
					data-params='[{{attachment.attachment_id}}, "from_{{ target_name }}", {{ target.pk }}]'>Delete</a>
			</td>
		</tr>
		{% endfor %}
	</tbody>
</table>

<div class="modal fade" id="delete-confirm-dialog" tabindex="-1" role="dialog" aria-labelledby="deleteConfirmDialogLabel" aria-hidden="true" style="display: none;">
	<div class="modal-dialog message-dialog-pf">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">
					<span class="pficon pficon-close"></span>
				</button>
				<h4 class="modal-title" id="myDeleteDialogLabel">Are you sure to delete attachment?</h4>
			</div>
			<div class="modal-body">
				<div>
					<p>Attachment will be deleted from plan, but the file is not removed actually.</p>
				</div>
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal" id="autofocusDelete">Cancel</button>
				<button type="button" class="btn btn-danger js-btn-confirm">Delete</button>
			</div>
		</div>
	</div>
</div>

{% endblock %}
