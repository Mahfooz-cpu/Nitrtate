{% extends "tcms_master.html" %}
{% load report_tags %}
{% block subtitle %}Custom Report Detail{% endblock %}

{% block custom_javascript %}
<script type="text/javascript" src="{{ STATIC_URL }}js/report.js"></script>
<script type="text/javascript">
Nitrate.Utils.after_page_load(Nitrate.Report.CustomDetails.on_load);
</script>
{% endblock %}

{% block page_content %}
	<nav aria-label="breadcrumb">
		<ol class="breadcrumb">
			<li class="breadcrumb-item"><a href="{% url "nitrate-index" %}">Home</a></li>
			<li class="breadcrumb-item"><a href="{% url "report-custom" %}">Custom</a></li>
			<li class="breadcrumb-item active" aria-current="page">{% for build in builds %}{{ build }}{% endfor %}</li>
		</ol>
	</nav>

	<div class="border-bottom">
		<form class="form-inline" action="{% url "report-custom-details" %}">
			<div class="form-group">
				<label class="" for="id_{{ form.product.name }}">Product</label>
				{{ form.product }}
			</div>
			<div class="form-group">
				<label class="" for="id_{{ form.pk__in.name }}">Build</label>
				{{ form.pk__in }}
			</div>
			<button type="submit" class="btn btn-primary">Generate</button>
		</form>

		{% if report_errors %}
		<div>{{ report_errors }}</div>
		{% endif %}
	</div>

	{% if not report_errors %}
	<table border="0" width="100%" cellpadding="6">
		{% for build in builds %}
		<tr>
			<td>
				<span style="padding-right: 10px"><strong>{{ build }}</strong></span>
				Plan: <span class="red">{{ build.plans_count|default_if_none:0 }}</span>
				Run: <span class="red">{{ build.runs_count|default_if_none:0 }}</span>
				Manual Cases: <span class="red">{{manual_count|percentage:total_count}} ({{manual_count}}/{{total_count}})</span>
				Automated Cases: <span class="red">{{auto_count|percentage:total_count}} ({{auto_count}}/{{total_count}})</span>
				Manual/Automated: <span class="red">{{both_count|percentage:total_count}} ({{both_count}}/{{total_count}})</span>
			</td>
			<td style="padding-right: 10px;">
				<span>Passed Case-Run</span>
				<div class="progress">
					<div class="progress-bar" role="progressbar" style="width: {{ build.passed_case_runs_percent|floatformat:1 }}%;"
						aria-valuenow="{{ build.passed_case_runs_percent|floatformat:1 }}" aria-valuemin="0" aria-valuemax="100">
						<span class="pl-1">{{ build.passed_case_runs_percent|floatformat:1 }}%</span>
					</div>
				</div>
			</td>
			<td>
				<span>Failed Case-Run</span>
				<div class="progress">
					<div class="progress-bar bg-danger" role="progressbar" style="width: {{ build.failed_case_runs_percent|floatformat:1 }}%"
						aria-valuenow="{{ build.failed_case_runs_percent|floatformat:1 }}" aria-valuemin="0" aria-valuemax="100">
						<span class="pl-1">{{ build.failed_case_runs_percent|floatformat:1 }}%</span>
					</div>
				</div>
			</td>
		</tr>
		{% endfor %}
	</table>

	{% include "report/custom_details_status_matrix.html" %}
	<h4 style="color: #900;">All Failed Case-Run List</h4>
	{% include "report/custom_details_case_runs.html" with case_runs=failed_case_runs %}
	<h4 style="color: #639;">All Blocked Case-Run List</h4>
	{% include "report/custom_details_case_runs.html" with case_runs=blocked_case_runs %}
	{% endif %} {# endif report_errors #}
{% endblock %}
