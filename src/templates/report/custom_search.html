{% extends "tcms_master.html" %}

{% load report_tags %}

{% block subtitle %}Custom Report{% endblock %}

{#{% block custom_stylesheet %}#}
{#<link rel="stylesheet" type="text/css" href="{{ STATIC_URL }}style/print.css" media="print" />#}
{#<link rel="stylesheet" type="text/css" href="{{ STATIC_URL }}style/dataTables/jquery.dataTables.css" />#}
{#<link rel="stylesheet" type="text/css" href="{{ STATIC_URL }}style/dataTables/jquery.dataTables_themeroller.css" />#}
{#{% endblock %}#}

{% block custom_javascript %}
{#<script type="text/javascript" src="{{ STATIC_URL }}js/lib/jquery.dataTables.js"></script>#}
<script type="text/javascript" src="{{ STATIC_URL }}js/report.js"></script>
<script type="text/javascript">
Nitrate.Utils.after_page_load(Nitrate.Report.CustomSearch.on_load);
</script>
{% endblock %}

{% block page_content %}
	<nav aria-label="breadcrumb">
		<ol class="breadcrumb">
			<li class="breadcrumb-item"><a href="{% url "nitrate-index" %}">Home</a></li>
			<li class="breadcrumb-item active" aria-current="page">Custom Reporting</li>
		</ol>
	</nav>

	<div class="row">
		<div class="col-2">
			<h2>Report Options</h2>
			<form id="id_form_search" action="{% url "report-custom" %}">
				{% include "report/form/search.html" %}
			</form>
		</div>
		<div class="col-10">
			{% if builds %}
				<ul class="list-group list-group-horizontal justify-content-end">
					<li class="list-group-item mr-auto border-0 pl-2"><b>{{ builds|length }} builds are selected</b></li>
					<li class="list-group-item border-0 pl-2 pr-2">Plan: <span class="red">{{ total_plans_count }}</span></li>
					<li class="list-group-item border-0 pl-2 pr-2">Run: <span class="red">{{ total_runs_count }}</span></li>
					<li class="list-group-item border-0 pl-2 pr-2">Manual Cases: <span class="red">{{manual_count|percentage:total_count}}({{manual_count}}/{{total_count}})</span></li>
					<li class="list-group-item border-0 pl-2 pr-2">Automated Cases: <span class="red">{{auto_count|percentage:total_count}}({{auto_count}}/{{total_count}})</span></li>
					<li class="list-group-item border-0 pl-2 pr-2">Manual/Automated: <span class="red">{{both_count|percentage:total_count}}({{both_count}}/{{total_count}})</span></li>
				</ul>
				<table id="report_table" class="table table-striped">
					<thead>
					<tr>
						<th>Build</th>
						<th>Plan</th>
						<th>Run</th>
						<th>Case-Run</th>
						<th>Passed case-run</th>
						<th>Failed case-run</th>
					</tr>
					</thead>
					<tbody>
					{% for build in builds %}
						<tr>
							<td>
								{% if build.plans_count %}
									<a href="{% url "report-custom-details" %}?product={{ form.cleaned_data.product.pk }}&pk__in={{ build.pk }}">{{ build }}</a>
								{% else %}
									{{ build }}
								{% endif %}
							</td>
							<td>{{ build.plans_count|default_if_none:0 }}</td>
							<td>
								{% if build.runs_count %}
									<a href="{% url "runs-all" %}?product={{ build.product.pk }}&build={{ build.pk }}&product_version={{ REQUEST_CONTENTS.build_run__product_version }}">{{ build.runs_count }}</a>
								{% else %}{{ build.runs_count|default_if_none:0 }}{% endif %}
							</td>
							<td>{{ build.case_runs_count|default_if_none:0 }}</td>
							<td>
								<div class="progress">
									<div class="progress-bar bg-info" role="progressbar"
										 style="width: {{ build.passed_case_runs_percent|floatformat:1 }}%"
										 aria-valuenow="{{ build.passed_case_runs_percent|floatformat:1 }}" aria-valuemin="0" aria-valuemax="100">
										<span class="pl-1">{{ build.passed_case_runs_percent|floatformat:1 }}% ({{ build.passed_case_runs_count }})</span>
									</div>
								</div>
							</td>
							<td>
								<div class="progress">
									<div class="progress-bar bg-danger" role="progressbar"
										 style="width: {{ build.failed_case_runs_percent|floatformat:1 }}%"
										 aria-valuenow="{{ build.failed_case_runs_percent|floatformat:1 }}" aria-valuemin="0" aria-valuemax="100">
										<span class="pl-1">{{ build.failed_case_runs_percent|floatformat:1 }}% ({{ build.failed_case_runs_count }})</span>
									</div>
								</div>
							</td>
						</tr>
					{% endfor %}
					</tbody>
				</table>
			{% else %}
				<table class="table table-striped">
					<thead>
					<tr>
						<th>Build</th>
						<th>Plan</th>
						<th>Run</th>
						<th>Case-Run</th>
						<th>Passed case-run</th>
						<th>Failed case-run</th>
					</tr>
					</thead>
					<tbody>
					</tbody>
				</table>
			{% endif %}
		</div>
	</div>

{% endblock %}
