{% extends "report/testing-report/master.html" %}

{% block testing_reoprt_breadcrumb %}
<nav aria-label="breadcrumb">
	<ol class="breadcrumb">
		<li class="breadcrumb-item"><a href="{% url "nitrate-index" %}">Home</a></li>
		<li class="breadcrumb-item"><a href="{% url "testing-report" %}">Testing Report</a></li>
		<li class="breadcrumb-item active" aria-current="page">By Plan's Tag Per Tag View</li>
	</ol>
</nav>
{% endblock %}

{% block report_content %}
{% if report_data %}
	{% if queries %}
	<ul class="list-group list-group-horizontal">
	{% for k, v in queries.items %}
		<li class="list-group-item border-0 pl-2 pr-2">
			<strong>{{ k|title }}</strong>: {{ v|safe }};
		</li>
	{% endfor %}
	</ul>
	{% endif %}

	<ul class="list-group list-group-horizontal">
		<li class="list-group-item border-0 pl-2 pr-2">
			Plan: <span class="red">{{ report_data.plans_count }}</span>
		</li>
		<li class="list-group-item border-0 pl-2 pr-2">
			Run: <span class="red">{{ report_data.runs_count }}</span>
		</li>
		<li class="list-group-item border-0 pl-2 pr-2">
			Case-Run: <span class="red">{{ report_data.caseruns_count }}</span>
		</li>
	</ul>

	{% for tag_name, plans_count, runs_count, caseruns_count, matrix_rows in report_data.reports %}
	<ul class="list-group list-group-horizontal justify-content-end">
		<li class="list-group-item border-0 mr-auto pl-2 pr-2">
			Plan Tag: <span>{{ tag_name }}</span>
		</li>
		<li class="list-group-item border-0 pl-2 pr-2">
			Run: <span class="red">{{ runs_count }}</span>
		</li>
		<li class="list-group-item border-0 pl-2 pr-2">
			Plan: <span class="red">{{ plans_count }}</span>
		</li>
		<li class="list-group-item border-0 pl-2 pr-2">
			Case Run: <span class="red">{{ caseruns_count }}</span>
		</li>
	</ul>

	<table class="table table-striped">
		<thead>
			<tr>
				<th width="15%">Build</th>
				<th width="20%">Plan</th>
				<th width="20%">Run</th>
				<th>Idle</th>
				<th>Running</th>
				<th>Paused</th>
				<th>Passed</th>
				<th>Failed</th>
				<th>Blocked</th>
				<th>Error</th>
				<th>Waived</th>
			</tr>
		</thead>
		<tbody>
		{% for build, plan, run, status_subtotal in matrix_rows %}
		<tr>
			{% ifnotequal build.1 None %}
			<td rowspan="{{ build.1 }}" class="bgRowspan">{{ build.0.name }}</td>
			{% endifnotequal %}
			{% ifnotequal plan.1 None %}
			<td {% ifnotequal plan.1 1 %}rowspan="{{ plan.1 }}"{% endifnotequal %} class="bgRowspan">
				<a href="{{ plan.0.get_absolute_url }}">[{{ plan.0.pk }}] {{ plan.0.name }}</a>
			</td>
			{% endifnotequal %}
			<td><a href="{{ run.get_absolute_url }}">{{ run.summary }}</a></td>
			<td><a href="{{ report_url }}{{path_without_build}}&r_build={{ build.0.pk }}&plan_tag={{ tag_name }}&run={{ run.pk }}&status=idle">{{ status_subtotal.IDLE|default:0 }}</a></td>
			<td><a href="{{ report_url }}{{path_without_build}}&r_build={{ build.0.pk }}&plan_tag={{ tag_name }}&run={{ run.pk }}&status=running">{{ status_subtotal.RUNNING|default:0 }}</a></td>
			<td><a href="{{ report_url }}{{path_without_build}}&r_build={{ build.0.pk }}&plan_tag={{ tag_name }}&run={{ run.pk }}&status=paused">{{ status_subtotal.PAUSED|default:0 }}</a></td>
			<td><a href="{{ report_url }}{{path_without_build}}&r_build={{ build.0.pk }}&plan_tag={{ tag_name }}&run={{ run.pk }}&status=passed">{{ status_subtotal.PASSED|default:0 }}</a></td>
			<td><a href="{{ report_url }}{{path_without_build}}&r_build={{ build.0.pk }}&plan_tag={{ tag_name }}&run={{ run.pk }}&status=failed">{{ status_subtotal.FAILED|default:0 }}</a></td>
			<td><a href="{{ report_url }}{{path_without_build}}&r_build={{ build.0.pk }}&plan_tag={{ tag_name }}&run={{ run.pk }}&status=blocked">{{ status_subtotal.BLOCKED|default:0 }}</a></td>
			<td><a href="{{ report_url }}{{path_without_build}}&r_build={{ build.0.pk }}&plan_tag={{ tag_name }}&run={{ run.pk }}&status=error">{{ status_subtotal.ERROR|default:0 }}</a></td>
			<td><a href="{{ report_url }}{{path_without_build}}&r_build={{ build.0.pk }}&plan_tag={{ tag_name }}&run={{ run.pk }}&status=waived">{{ status_subtotal.WAIVED|default:0 }}</a></td>
		</tr>
		{% endfor %}
		</tbody>
	</table>
	{% empty %}
	<table class="table table-striped">
		<thead>
			<tr>
				<th width="15%">Build</th>
				<th width="20%">Plan</th>
				<th width="20%">Run</th>
				<th>Idle</th>
				<th>Running</th>
				<th>Paused</th>
				<th>Passed</th>
				<th>Failed</th>
				<th>Blocked</th>
				<th>Error</th>
				<th>Waived</th>
			</tr>
		</thead>
		<tbody>
			<tr><td colspan="11" align="center">No report data.</td></tr>
		</tbody>
	</table>
	{% endfor %}
{% endif %}
{% endblock %}
