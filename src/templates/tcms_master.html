{% load cache %}
<!doctype html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

	<link href="{{ STATIC_URL }}style/fontawesome.css" rel="stylesheet">
	<link href="{{ STATIC_URL }}style/bootstrap/bootstrap.min.css" rel="stylesheet">
	<link href="{{ STATIC_URL }}style/nitrate.css" rel="stylesheet">

	<style>
		.bd-placeholder-img {
			font-size: 1.125rem;
			text-anchor: middle;
			-webkit-user-select: none;
			-moz-user-select: none;
			-ms-user-select: none;
			user-select: none;
		}

		@media (min-width: 768px) {
			.bd-placeholder-img-lg {
				font-size: 3.5rem;
			}
		}
	</style>

	<script src="{{ STATIC_URL }}js/lib/jquery-3.3.1.min.js"></script>
	<script src="{{ STATIC_URL }}js/lib/bootstrap/bootstrap.bundle.min.js"></script>

	<script type="text/javascript" language="javascript" charset="utf-8">
		jQuery.noConflict();
		var jQ = jQuery;
		// Top level namespace
		window.Nitrate = {};

		window.__admin_media_prefix__ = "{{ STATIC_URL }}admin/";
		{% if request.user.is_authenticated %}
		Nitrate.User = {
			pk: {{ request.user.pk }},
			username: '{{ request.user.username }}',
			email: '{{ request.user.email }}',
		};
		{% else %}
		Nitrate.User = {
			pk: null,
			username: 'anonymous',
			email: 'anonymous@anywhere.com',
		};
		{% endif %}
	</script>

	<script type="text/javascript" src='{{ STATIC_URL }}js/tcms_actions.js'></script>
	{% block custom_javascript %}{% endblock %}

	<title>Nitrate - {% block subtitle %}{% endblock %}</title>
</head>
<body>
<nav class="navbar navbar-expand-md navbar-dark bg-dark">
	<a class="navbar-brand" href="{% url "nitrate-index" %}">
		<img src="{{ STATIC_URL }}images/logo_2.png" height="30px">
	</a>
	<button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarsExampleDefault"
		aria-controls="navbarsExampleDefault" aria-expanded="false" aria-label="Toggle navigation">
		<span class="navbar-toggler-icon"></span>
	</button>

	<div class="collapse navbar-collapse" id="nitrateNavBar">
		<ul class="navbar-nav mr-auto">
			<li class="nav-item dropdown {% ifequal module 'planning' %}active{% endifequal %}">
				<a class="nav-link dropdown-toggle" href="#" id="navbarPlanning" data-toggle="dropdown"
				   aria-haspopup="true" aria-expanded="false">PLANNING</a>
				<div class="dropdown-menu" aria-labelledby="navbarPlanning">
					<a class="dropdown-item {% ifequal sub_module 'search_plans' %}active{% endifequal %}"
					   href="{% url "plans-all" %}">Search Plans</a>
					{% if user.is_authenticated %}
					<a class="dropdown-item {% ifequal sub_module 'my_plans' %}active{% endifequal %}"
					   href="{% url "plans-all" %}?author__email__startswith={{ user.email }}">My Plans</a>
					<a class="dropdown-item {% ifequal sub_module 'new_plan' %}active{% endifequal %}"
					   href="{% url "plans-new" %}">New Plan</a>
					{% endif %}
				</div>
			</li>
			<li class="nav-item dropdown {% ifequal module "testing" %}active{% endifequal %}">
				<a class="nav-link dropdown-toggle" href="#" id="navbarTesting" data-toggle="dropdown"
				   aria-haspopup="true" aria-expanded="false">TESTING</a>
				<div class="dropdown-menu" aria-labelledby="navbarReporting">
					<a class="dropdown-item {% ifequal sub_module 'search_runs' %}active{% endifequal %}"
					   href="{% url "runs-all" %}">Search Runs</a>
					<a class="dropdown-item {% ifequal sub_module 'search_cases' %}active{% endifequal %}"
					   href="{% url "cases-all" %}">Search Cases</a>
					{% if user.is_authenticated %}
					<a class="dropdown-item {% ifequal sub_module 'my_cases' %}active{% endifequal %}"
					   href="{% url "runs-all" %}?people={{ user.email }}">My Runs</a>
					<a class="dropdown-item {% ifequal sub_module 'new_case' %}active{% endifequal %}"
					   href="{% url "cases-new" %}">New Case</a>
					{% endif %}
				</div>
			</li>
			<li class="nav-item dropdown {% ifequal module "env" %}active{% endifequal %}">
				<a class="nav-link dropdown-toggle" href="#" id="navbarEnvironment" data-toggle="dropdown"
				   aria-haspopup="true" aria-expanded="false">ENVIRONMENT</a>
				<div class="dropdown-menu" aria-labelledby="navbarEnvironment">
					<a class="dropdown-item {% ifequal sub_module "env_groups" %}active{% endifequal %}"
					   href="{% url "management-env-groups" %}">Groups</a>
					<a class="dropdown-item {% ifequal sub_module "env_properties" %}active{% endifequal %}"
					   href="{% url "management-env-properties" %}">Properties</a>
				</div>
			</li>
			<li class="nav-item dropdown {% ifequal module "report" %}active{% endifequal %}">
				<a class="nav-link dropdown-toggle" href="#" id="navbarReporting" data-toggle="dropdown"
				   aria-haspopup="true" aria-expanded="false">REPORTING</a>
				<div class="dropdown-menu" aria-labelledby="navbarReporting">
					<a class="dropdown-item {% ifequal sub_module "overall_report" %}active{% endifequal %}"
						href="{% url "report-overall" %}">Overall</a>
					<a class="dropdown-item {% ifequal sub_module "custom_report" %}active{% endifequal %}"
						href="{% url "report-custom" %}">Custom</a>
					<a class="dropdown-item {% ifequal sub_module "testing_report" %}active{% endifequal %}"
						href="{% url "testing-report" %}">Testing Report</a>
				</div>
			</li>
			{% if user.is_staff %}
			<li class="nav-item dropdown {% if not module %}active{% endif %}">
				<a class="nav-link dropdown-toggle" href="#" id="navbarAdmin" data-toggle="dropdown"
				   aria-haspopup="true" aria-expanded="false">ADMIN</a>
				<div class="dropdown-menu" aria-labelledby="navbarAdmin">
					{# FIXME: Is "products" a correct module name for Auth app? #}
					<a class="dropdown-item {% ifequal sub_module "products" %}active{% endifequal %}"
					   href="{% url "admin:app_list" "auth" %}">Auth</a>
					{# FIXME: Is "environments" a correct module name for Auth app? #}
					<a class="dropdown-item {% ifequal sub_module "environments" %}active{% endifequal %}"
					   href="{% url "admin:app_list" "management" %}">Management</a>
					<a class="dropdown-item {% ifequal sub_module "testplans" %}active{% endifequal %}"
					   href="{% url "admin:app_list" "testplans" %}">Test Plans</a>
					<a class="dropdown-item {% ifequal sub_module "testcases" %}active{% endifequal %}"
					   href="{% url "admin:app_list" "testcases" %}">Test Cases</a>
				</div>
			</li>
		{% endif %}
		</ul>
		<form class="form-inline my-2 my-lg-0" method="get" action="{% url "nitrate-search" %}">
			<select name="search_type" class="form-control mr-sm-2">
				<option value="plans" {% ifequal sub_module "testplans" %}selected{% endifequal %}>Test Plan</option>
				<option value="runs" {% ifequal sub_module "testruns" %}selected{% endifequal %}>Test Run</option>
				<option value="cases" {% ifequal sub_module "testcases" %}selected{% endifequal %}>Test Case</option>
			</select>
			<input class="form-control mr-sm-2" type="text" placeholder="Search by keyword" name="search_content"
				aria-label="Search">
			<button class="btn btn-outline-success my-2 my-sm-0" type="submit">Search</button>
		</form>
		<ul class="navbar-nav navbar-right">
			{% if user.is_authenticated %}
			<li class="nav-item p-2">
				<a href="#" title="Bookmark this page"><i class="far fa-star"></i></a>
			</li>
			{% endif %}
			<li class="nav-item">
				<a class="nav-link" href="#">About</a>
			</li>
			<li class="nav-item {% if user.is_authenticated %}dropdown{% endif %}">
				{% if user.is_authenticated %}
					<a class="nav-link dropdown-toggle" href="#" id="navbarLoggedUser" data-toggle="dropdown"
					   aria-haspopup="true" aria-expanded="false">Welcome, {{ user }}</a>
					<div class="dropdown-menu" aria-labelledby="navbarLoggedUser">
						<a class="dropdown-item" href="{% url "nitrate-logout" %}?next={{ request.path }}">Logout</a>
					</div>
				{% else %}
					<a class="nav-link" href="{% url "nitrate-login" %}?next={{ request.path }}">Login</a>
				{% endif %}
			</li>
		</ul>
	</div>
</nav>

<main class="flex-shrink-0" role="main">
	<div class="container-fluid">
		{% block page_content %}{% endblock %}
	</div>
</main>

{% cache 600 footerbar%}
<footer class="footer mt-auto py-3 fixed-bottom">
	<div class="container">
		{% for link in SETTINGS.FOOTER_LINKS %}
		<a href="{{ link.0 }}">{{ link.1 }}</a>{% if not forloop.last %}|{% endif %}
		{% endfor %}
		<span class="text-muted">Nitrate {{ SETTINGS.NITRATE_VERSION }} &copy; {% now "Y" %} Nitrate Team</span>
	</div>
</footer>
{% endcache %}
</body>
</html>
